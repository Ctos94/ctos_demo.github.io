import{_ as t,r as e,o as a,e as l,w as r,d as s,h as n,b as i,t as o,a as d,F as u,p as m,A as h,s as c,i as p,k as f,j as y,n as v,l as b}from"./index-70eb1b2b.js";import{_ as g}from"./DateInput-bc2bad39.js";import{P as _}from"./PriceFormat-71d3e43a.js";import{_ as k}from"./Chart-b3a708bb.js";import{f as w}from"./common-5afeacdf.js";const x={class:"d-flex"},$={class:"ml-2"},P={class:"d-flex mt-4"},q={class:"ml-2"};const D=t({components:{PriceFormat:_,DateInput:g},props:{data:{type:Object}},data:()=>({date:void 0}),computed:{date_:{get(){return this.date||new Date(this.data.year,this.data.month-1)},set(t){this.$emit("dateChange",t.getFullYear(),t.getMonth()+1),this.date=t}}}},[["render",function(t,h,c,p,f,y){const v=e("PriceFormat"),b=g,_=e("v-icon"),k=e("v-card-text"),w=e("v-card"),D=e("v-sheet");return a(),l(D,{border:"",rounded:""},{default:r((()=>[s(w,{flat:""},{default:r((()=>[s(k,null,{default:r((()=>[n("div",x,[n("div",null,[h[1]||(h[1]=i(" 总支出 ")),s(v,{class:"font-weight-black",size:24,amount:c.data.priceTotal},null,8,["amount"])]),n("div",$,[i(o(c.data.year)+"年总支出 ",1),s(v,{class:"font-weight-black",size:24,amount:c.data.yearPriceTotal},null,8,["amount"])])]),n("div",P,[n("div",null,[s(b,{format:"yyyy年MM月",width:120,clearable:!1,density:"compact",modelValue:y.date_,"onUpdate:modelValue":h[0]||(h[0]=t=>y.date_=t)},null,8,["modelValue"])]),n("div",q,[i(" 支出共计"+o(c.data.monthCount)+"笔，合计 ",1),s(v,{class:"font-weight-black mr-2",size:24,amount:c.data.monthPrice},null,8,["amount"]),c.data.compare?(a(),d(u,{key:0},[i(" 相较"+o(1==c.data.month?12:c.data.month-1)+"月 ",1),s(_,{style:{margin:"0 -10px 0 -10px","font-size":"30px"},color:c.data.compare>0?"red-darken-1":"green-darken-1",icon:c.data.compare>0?"mdi-triangle-small-up":"mdi-triangle-small-down"},null,8,["color","icon"]),i(" "+o(c.data.compare)+"% ",1)],64)):m("",!0)])])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-0a487ba4"]]);const F=t({components:{Chart:k,PriceFormat:_},props:{year:{type:Number,default:0},month:{type:Number,default:0}},computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},data:()=>({visible:!1,bills:[],tableTitle:"",tableLoading:!1}),mounted(){this.$refs.chart.chart.on("click",(t=>{if(t)if(0===Number(t.value))this.$message.error("当日没有消费产生");else{let e=`${this.year}-${this.month<10?0+String(this.month):this.month}-${t.name<10?0+String(t.name):t.name}`;this.tableTitle=`${e}支出`,this.bills=[],this.tableLoading=!0,this.$request.get({url:h.bill.list.by_date,params:{date:e}}).then((t=>{this.bills=t})).finally((()=>{this.tableLoading=!1})),this.visible=!0}}))},methods:{request:function(){if(!this.year||!this.month)return;let t=[],e=[];this.$request.get({url:h.bill.dashboard.compared,params:{year:this.year,month:this.month},loading:{target:"#bill_line"}}).then((a=>{a.forEach((a=>{t.push(a.unit),e.push(a.price)})),this.$refs.chart.chart.setOption({tooltip:{trigger:"axis",formatter:function(t,e,a){return`${t[0].axisValue}日: ${w(t[0].data)}`}},xAxis:{type:"category",data:t},yAxis:{type:"value"},series:[{data:e,type:"line",markLine:{silent:!0,lineStyle:{color:"rgba(193, 65, 65, 1)"},data:[{type:"average"}]}}]})})).finally((()=>{}))}},watch:{changeData(t){this.request()}}},[["render",function(t,n,i,o,d,u){const m=k,h=e("v-card-text"),c=e("v-card"),p=e("PriceFormat"),f=e("v-data-table-virtual"),y=e("v-dialog"),v=e("v-sheet");return a(),l(v,{id:"bill_line",border:"",rounded:""},{default:r((()=>[s(c,{flat:"",title:i.year&&i.month?`${i.year}年${i.month}月支出对比`:"月支出对比"},{default:r((()=>[s(h,null,{default:r((()=>[s(m,{ref:"chart"},null,512)])),_:1})])),_:1},8,["title"]),s(y,{modelValue:d.visible,"onUpdate:modelValue":n[0]||(n[0]=t=>d.visible=t),width:"80%"},{default:r((()=>[s(c,{title:d.tableTitle},{default:r((()=>[s(h,null,{default:r((()=>[s(f,{loading:d.tableLoading,headers:[{title:"交易方",key:"payee",width:280,sortable:!1},{title:"支出项",key:"detail",sortable:!1},{title:"金额",key:"price",width:100,sortable:!1}],items:d.bills},{"item.price":r((({item:t})=>[s(p,{amount:t.price},null,8,["amount"])])),_:1},8,["loading","items"])])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])])),_:1})}]]),j={class:"d-flex justify-space-between"},N={class:"text-overflow pr-8"},V={class:"font-12 text-grey"};const C=t({components:{PriceFormat:_},props:{year:{type:Number,default:0},month:{type:Number,default:0}},data:()=>({rank:[]}),computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},methods:{request:function(){this.year&&this.month&&this.$request.get({url:h.bill.dashboard.rank,params:{year:this.year,month:this.month},loading:{target:"#rank"}}).then((t=>{this.rank=t}))}},watch:{changeData(t){this.request()}}},[["render",function(t,i,m,h,p,f){const y=e("PriceFormat"),v=e("v-list-item"),b=e("v-list"),g=e("v-card-text"),_=e("v-card"),k=e("v-sheet");return a(),l(k,{id:"rank",border:"",rounded:""},{default:r((()=>[s(_,{flat:"",title:m.year&&m.month?`${m.year}年${m.month}月支出排行`:"月支出排行"},{default:r((()=>[s(g,null,{default:r((()=>[s(b,{class:"pa-0"},{default:r((()=>[(a(!0),d(u,null,c(p.rank,(t=>(a(),l(v,{class:"pa-0",key:t.id},{default:r((()=>[n("div",j,[n("span",N,o(t.detail),1),s(y,{amount:t.price},null,8,["amount"])]),n("div",V,o(t.date),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["title"])])),_:1})}]]),L={class:"d-flex justify-space-between"};const T=t({components:{PriceFormat:_},props:{year:{type:Number,default:0},month:{type:Number,default:0}},data:()=>({classifies:[]}),computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},methods:{request:function(){this.year&&this.month&&this.$request.get({url:h.bill.dashboard.classify,params:{year:this.year,month:this.month},loading:{target:"#classify"}}).then((t=>{this.classifies=t}))}},watch:{changeData(t){this.request()}}},[["render",function(t,i,h,p,f,y){const v=e("PriceFormat"),b=e("v-progress-linear"),g=e("v-list-item"),_=e("v-list"),k=e("v-card-text"),w=e("v-card"),x=e("v-sheet");return a(),l(x,{id:"classify",border:"",rounded:""},{default:r((()=>[s(w,{flat:"",title:h.year&&h.month?`${h.year}年${h.month}月支出分类`:"月支出分类"},{default:r((()=>[f.classifies.length?(a(),l(k,{key:0},{default:r((()=>[s(_,{class:"pa-0"},{default:r((()=>[(a(!0),d(u,null,c(f.classifies,((t,e)=>(a(),l(g,{class:"pa-0",key:e},{default:r((()=>[n("div",L,[n("div",null,o(t.tag)+o(t.percentage)+"%",1),s(v,{amount:t.price},null,8,["amount"])]),s(b,{color:"blue-lighten-1","model-value":t.percentage},null,8,["model-value"])])),_:2},1024)))),128))])),_:1})])),_:1})):m("",!0)])),_:1},8,["title"])])),_:1})}]]),z={__name:"Dashboard",setup(t){const n=p(),i=f({year:null,month:null}),o=function(t,e){b.get({url:h.bill.dashboard.overview,params:{year:t,month:e},loading:{target:"#overview"}}).then((t=>{i.value=t}))};return y((()=>{n.commit("update_sider_active","/bill/dashboard")})),v((()=>{o()})),(t,n)=>{const d=e("v-col"),u=e("v-row"),m=e("v-sheet");return a(),l(m,null,{default:r((()=>[s(u,null,{default:r((()=>[s(d,{cols:"8",class:"pr-0"},{default:r((()=>[s(D,{id:"overview",class:"mb-2",data:i.value,onDateChange:o},null,8,["data"]),s(F,{year:i.value.year,month:i.value.month},null,8,["year","month"])])),_:1}),s(d,{cols:"4"},{default:r((()=>[s(T,{class:"mb-2",year:i.value.year,month:i.value.month},null,8,["year","month"]),s(C,{year:i.value.year,month:i.value.month},null,8,["year","month"])])),_:1})])),_:1})])),_:1})}}};export{z as default};
