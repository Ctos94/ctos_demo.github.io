import{_ as e,N as t,a as l,o as a,c as i,w as n,b as s,h as o,u as d,d as u,F as r,e as m,r as c,H as p,O as v,G as h,f,C as y,A as b,g,n as _,M as k,B as V,L as w,y as x,k as $,l as C,t as T}from"./index-de9476e1.js";const I=e({__name:"TreeSelectItem",props:{item:{}},setup(e){const c=t("expand"),p=t("itemClick"),v=t("itemTitle"),h=t("itemValue"),f=t("itemChildren");return(t,y)=>{const b=l("v-icon"),g=l("v-list-item"),_=l("TreeSelectItem",!0),k=l("v-list-group");return a(),i(k,{value:e.item[d(h)],"append-icon":"none"},{activator:n((({isOpen:t})=>[s(g,{onClick:y[1]||(y[1]=o((t=>d(p)(e.item)),["stop"])),title:e.item[d(v)],value:e.item[d(h)]},{prepend:n((()=>[e.item&&e.item[d(f)]&&e.item[d(f)].length>0?(a(),i(b,{key:0,class:"icon",onClick:y[0]||(y[0]=o((t=>d(c)(e.item)),["stop"])),icon:t?"mdi-menu-down":"mdi-menu-right"},null,8,["icon"])):(a(),i(b,{key:1,icon:""}))])),_:2},1032,["title","value"])])),default:n((()=>[(a(!0),u(r,null,m(e.item[d(f)],(e=>(a(),i(_,{key:e[d(h)],item:e},null,8,["item"])))),128))])),_:1},8,["value"])}}},[["__scopeId","data-v-7593b3d2"]]),S=e({__name:"TreeSelect",props:{label:{type:String,default:"Select"},items:{type:Array,default:function(){return[]}},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},itemChildren:{type:String,default:"children"},hideDetails:{type:Boolean,default:!1},returnNode:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const i=e,o=c(null),d=c([]),r=c(new Set),m=t;return p(d,(e=>{m("update:modelValue",e?i.returnNode?e[0]:e[0][i.itemValue]:null),o&&o.value.blur()}),{deep:!0}),v("itemTitle",h((()=>i.itemTitle))),v("itemValue",h((()=>i.itemValue))),v("itemChildren",h((()=>i.itemChildren))),v("expand",(e=>{r.value.has(e[i.itemValue])?r.value.delete(e[i.itemValue]):r.value.add(e[i.itemValue])})),v("itemClick",(e=>{d.value=[e]})),(t,i)=>{const m=l("v-list"),c=l("v-select");return a(),u("div",null,[s(c,{"hide-details":e.hideDetails,ref_key:"selectRef",ref:o,label:e.label,modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=e=>d.value=e),items:e.items,clearable:""},{selection:n((({item:t})=>[f("span",null,y(t.raw[e.itemTitle]),1)])),item:n((({item:e})=>[s(m,{density:"compact",opened:r.value,"onUpdate:opened":i[0]||(i[0]=e=>r.value=e)},{default:n((()=>[s(I,{item:e.raw},null,8,["item"])])),_:2},1032,["opened"])])),_:1},8,["hide-details","label","modelValue","items"])])}}},[["__scopeId","data-v-b1ed9204"]]);const U=e({components:{TreeSelect:S},props:{parents:{type:Array,default:function(){return[]}}},emits:["submited"],data:()=>({visible:!1,submit_loading:!1,form:{}}),computed:{parents$:{get(){return function e(t){return t.reduce(((t,l)=>("PAGE"!=l.type&&(l.children&&l.children.length>0&&(l.children=e(l.children)),t.push(l)),t)),[])}(JSON.parse(JSON.stringify(this.parents)))}},parentId$:{get(){return this.form.parentId},set(e){this.form.parentId=e||null}}},methods:{edit(e){this.form={...e},this.visible=!0},async submit(){const{valid:e}=await this.$refs.form.validate();e&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?b.system.menu.update:b.system.menu.create,data:this.form,json:!0}).then((()=>{this.visible=!1,this.$emit("submited")})).finally((()=>{this.submit_loading=!1})))}},watch:{visible(e){e||(this.$refs.form.reset(),this.form={})}}},[["render",function(e,t,d,m,c,p){const v=l("v-btn"),h=l("v-text-field"),f=l("v-col"),y=l("v-row"),b=l("v-select"),_=S,k=l("v-card-text"),V=l("v-spacer"),w=l("v-btn-text"),x=l("v-card-actions"),$=l("v-card"),C=l("v-form"),T=l("v-dialog");return a(),u(r,null,[s(v,{onClick:t[0]||(t[0]=e=>c.visible=!0),color:"blue-lighten-1",text:"添加菜单"}),s(T,{modelValue:c.visible,"onUpdate:modelValue":t[9]||(t[9]=e=>c.visible=e),"max-width":"600"},{default:n((()=>[s(C,{onSubmit:t[8]||(t[8]=o((()=>{}),["prevent"])),ref:"form"},{default:n((()=>[s($,null,{default:n((()=>[s(k,null,{default:n((()=>[s(y,{class:"mt-0"},{default:n((()=>[s(f,null,{default:n((()=>[s(h,{label:"名称",rules:[e.$validator.required],modelValue:c.form.title,"onUpdate:modelValue":t[1]||(t[1]=e=>c.form.title=e)},null,8,["rules","modelValue"])])),_:1}),s(f,null,{default:n((()=>[s(h,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:c.form.sort,"onUpdate:modelValue":t[2]||(t[2]=e=>c.form.sort=e)},null,8,["rules","modelValue"])])),_:1})])),_:1}),s(y,{class:"mt-0"},{default:n((()=>[s(f,null,{default:n((()=>[s(b,{rules:[e.$validator.required],items:[{title:"菜单",value:"MENU"},{title:"页面",value:"PAGE"}],modelValue:c.form.type,"onUpdate:modelValue":t[3]||(t[3]=e=>c.form.type=e),label:"类型"},null,8,["rules","modelValue"])])),_:1})])),_:1}),c.form.id?g("",!0):(a(),i(_,{key:0,itemTitle:"title",itemValue:"id",label:"上级菜单",items:p.parents$,modelValue:p.parentId$,"onUpdate:modelValue":t[4]||(t[4]=e=>p.parentId$=e)},null,8,["items","modelValue"])),s(h,{rules:[e.$validator.required],label:"代码",modelValue:c.form.code,"onUpdate:modelValue":t[5]||(t[5]=e=>c.form.code=e)},null,8,["rules","modelValue"]),s(h,{label:"路径",modelValue:c.form.path,"onUpdate:modelValue":t[6]||(t[6]=e=>c.form.path=e)},null,8,["modelValue"])])),_:1}),s(x,null,{default:n((()=>[s(V),s(w,{text:"取消",onClick:t[7]||(t[7]=e=>c.visible=!1)}),s(w,{disabled:c.submit_loading,loading:c.submit_loading,color:"primary",text:"保存",onClick:p.submit},null,8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}]]),A={__name:"MenuPermissionDialog",setup(e,{expose:t}){const o=[{key:"summary",width:"200",title:"说明",sortable:!1},{key:"code",title:"代码",width:"350",sortable:!1},{key:"methods",width:"140",title:"Method",sortable:!1},{key:"api",title:"API",width:"300",sortable:!1}],d=c(""),u=c(null),r=c(!1),m=c([]),p=c([]),v=e=>m.value.includes(e),h=()=>{_.post({url:b.system.menu.set_permissions,data:{menuId:u.value,codes:m.value},json:!0,loading:{target:"#permission"}}).then((()=>{k.success("保存成功")}))},f=async()=>{await _.get({url:b.system.permission.codes}).then((e=>{p.value=e}))},y=async()=>{await _.get({url:b.system.menu.permissions,params:{menuId:u.value},loading:{target:"#permission"}}).then((e=>{m.value=e}))};return t({show:e=>{u.value=e,r.value=!0,V((()=>{f(),y()}))}}),(e,t)=>{const u=l("v-text-field"),c=l("v-checkbox-btn"),f=l("v-data-table-virtual"),y=l("v-card-text"),b=l("v-btn-text"),g=l("v-card-actions"),_=l("v-card"),k=l("v-dialog");return a(),i(k,{scrollable:"",class:"dialog",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),"max-width":"1200px"},{default:n((()=>[s(_,{id:"permission"},{default:n((()=>[s(y,{class:"pb-0"},{default:n((()=>[s(u,{clearable:"",density:"compact",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"]),s(f,{search:d.value,"show-select":"",items:p.value,headers:o,"hide-default-footer":"","hide-default-header":""},{"item.data-table-select":n((({item:e})=>[s(c,{"onUpdate:modelValue":t=>{return l=e.code,void(v(l)?m.value=m.value.filter((e=>e!==l)):m.value.push(l));var l},"model-value":v(e.code)},null,8,["onUpdate:modelValue","model-value"])])),_:1},8,["search","items"])])),_:1}),s(g,null,{default:n((()=>[s(b,{color:"primary",text:"保存",onClick:h})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}},N={key:2,style:"margin-left: 36px"};const D=e({name:"TreeTableItem",props:{columns:{type:Array},item:{type:Object},loop:{type:Number,default:0}},computed:{columns_(){return this.columns.filter((e=>e.key))}},data:()=>({expand:!1})},[["render",function(e,t,s,d,c,p){const v=l("v-btn"),h=l("TreeTableItem",!0);return a(),u(r,null,[f("tr",null,[(a(!0),u(r,null,m(p.columns_,((e,l)=>(a(),u("td",{key:l,style:w({textAlign:e.align})},[0==l?(a(),u(r,{key:0},[s.loop&&s.loop>0?(a(),u("span",{key:0,style:w(`margin-left: ${15*s.loop}px`)},null,4)):g("",!0),s.item.children&&s.item.children.length>0?(a(),i(v,{key:1,class:"mr-2",density:"compact",onClick:t[0]||(t[0]=o((e=>c.expand=!c.expand),["stop"])),icon:c.expand?"mdi-menu-down":"mdi-menu-right"},null,8,["icon"])):(a(),u("span",N))],64)):g("",!0),f("span",null,y(e.render?e.render(s.item[e.key],s.item):s.item[e.key]),1)],4)))),128)),x(e.$slots,"item.actions",{row:s.item})]),s.item&&s.item.children&&s.item.children.length>0&&c.expand?(a(!0),u(r,{key:0},m(s.item.children,(t=>(a(),i(h,{key:t.id,loop:s.loop+1,item:t,columns:s.columns},{"item.actions":n((({row:t})=>[x(e.$slots,"item.actions",{row:t})])),_:2},1032,["loop","item","columns"])))),128)):g("",!0)],64)}]]),M={components:{TreeTableItem:D},props:{loading:{type:Boolean,default:!1},headers:{type:Array,defalut:()=>[]},items:{type:Array,defalut:()=>[]}},data:()=>({}),mounted(){},methods:{filter:e=>e.filter((e=>e.key))}},P={key:0,class:"data-table-actions",style:{width:"200px"}},j=[f("span",null,null,-1)];const q=e(M,[["render",function(e,t,i,o,d,c){const p=D,v=l("v-data-table-virtual");return a(),u("div",null,[s(v,{loading:i.loading,headers:[...i.headers,{}],items:i.items},{headers:n((({headers:t})=>[f("tr",null,[(a(!0),u(r,null,m(c.filter(t[0]),(e=>(a(),u("th",{key:e.key,style:w({width:`${e.width}px`})},[f("div",{class:"v-data-table-header__content",style:w({justifyContent:e.align})},[f("span",null,y(e.title),1)],4)],4)))),128)),e.$slots["item.actions"]?(a(),u("th",P,j)):g("",!0)])])),item:n((({item:t,columns:l})=>[s(p,{item:t,columns:l},{"item.actions":n((({row:t})=>[x(e.$slots,"item.actions",{row:t})])),_:2},1032,["item","columns"])])),_:3},8,["loading","headers","items"])])}]]),O={width:"200"},B={__name:"Menus",setup(e){const t=$(),i=c(!1),o=c([]),d=()=>{i.value=!0,_.get({url:b.system.menu.list}).then((e=>{o.value=e})).finally((()=>{i.value=!1}))};return C((()=>{t.commit("update_sider_active","/system/menus")})),T((()=>{d()})),(e,t)=>{const r=l("v-btn-link");return a(),u("div",null,[s(U,{ref:"menuDialog",onSubmited:d,parents:o.value},null,8,["parents"]),s(A,{ref:"menuPermissionDialog"},null,512),s(q,{headers:[{title:"标题",key:"title",width:180},{title:"类型",key:"type",width:150,align:"center",render:(e,t)=>"MENU"===e?"菜单":"页面"},{title:"路径",key:"path"},{title:"代码",key:"code",width:300}],items:o.value,loading:i.value},{"item.actions":n((({row:t})=>[f("td",O,[s(r,{onClick:l=>e.$refs.menuDialog.edit(t),text:"编辑"},null,8,["onClick"]),s(r,{onClick:l=>e.$refs.menuPermissionDialog.show(t.id),text:"权限管理"},null,8,["onClick"])])])),_:1},8,["headers","items","loading"])])}}};export{B as default};
